import cv2
import numpy as np
from kicker.image.analyzer import Analyzer

ball = np.array([[0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,255,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0],
    [0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,0,0],
    [0,0,0,0,255,255,255,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,255,255],
    [0,0,255,255,0,0,0,0,0,0,0,0,0,255,0,0,255,0],
    [0,0,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0],
    [0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255],
    [0,255,0,0,0,0,0,0,0,0,0,0,0,0,255,0,0,255],
    [0,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0],
    [255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255],
    [255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0],
    [255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,255,255,0],
    [0,255,0,255,255,0,0,0,0,0,0,0,0,0,255,255,0,0],
    [0,255,0,0,255,255,0,0,0,0,0,255,255,255,255,0,0,255],
    [0,0,255,0,0,255,255,255,255,255,255,255,0,0,0,0,0,255],
    [0,0,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255],
    [0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,255,255,0],
    [0,0,0,255,255,0,0,255,0,0,0,0,0,0,255,255,0,0],
    [0,0,0,0,255,255,0,0,0,0,0,0,0,255,255,0,0,0],
    [255,255,0,0,0,255,255,255,255,0,255,255,255,255,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0]], dtype=np.dtype('uint8'))

def add_ball(img):
    img_canny = cv2.Canny(cv2.cvtColor(img, cv2.COLOR_RGB2GRAY), 600, 480)

    res = cv2.matchTemplate(img_canny, ball, cv2.TM_CCOEFF)
    min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(res)

    top_left = max_loc
    bottom_right = (top_left[0] + 20, top_left[1] + 20)

    cv2.rectangle(img, top_left, bottom_right, 255, 2)

    center_x = top_left[0] + 10
    center_y = top_left[1] + 10


    return (img, center_x, center_y)
